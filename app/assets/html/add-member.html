<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    function submitData() {
      var validation_error = validateform();
      if (validation_error) {
        return;
      }

      var person = {
        name: $("#name").val(),
        address: $("#address").val(),
        permanent_address: $("#permanent_address").val(),
        phone: $("#phone").val(),
        email: $("#email").val(),
        aadhar: $("#aadhar").val(),
        dob: $("#dob").val()
      }
      console.dir(person);
      $.ajax({
        url: '/api/members/',
        type: 'post',
        dataType: 'json',
        contentType: 'application/json',
        success: function (response_data) {
          if (response_data.response_action == 'redirect') {
            window.location.replace(response_data.url + "?msg=" + response_data.msg);
          }
        },
        data: JSON.stringify(person)
      });
    }
    function validateform() {
      var name = document.addMemberForm.name.value;
      if (name == null || name == "") {
        alert("Please Enter Your Name");
        return true;
      }
      var address = document.addMemberForm.address.value;
      if (address == "") {
        alert("Please Enter Your Address");
        document.addMemberForm.address.focus();
        return true;
      }
      var permanent_address = document.addMemberForm.permanent_address.value;
      if (permanent_address == "") {
        alert("Please Enter Your Permanent_Address");
        document.addMemberForm.permanent_address.focus();
        return true;
      }
      var phone = document.addMemberForm.phone.value;
      if (phone == "") {
        alert("Please Enter Your phone");
        document.addMemberForm.phone.focus();
        return true;
      }

      var email = document.addMemberForm.email.value;
      atpos = email.indexOf("@");
      dotpos = email.lastIndexOf(".");

      if (atpos < 1 || (dotpos - atpos < 2)) {
        alert("Please enter correct email")
        document.addMemberForm.email.focus();
        return true
      }
      return false;


     
      // Declaring valid date character, minimum year and maximum year
      var dtCh = "/";
      var minYear = 1900;
      var maxYear = 2100;

      function isInteger(s) {
        var i;
        for (i = 0; i < s.length; i++) {
          // Check that current character is number.
          var c = s.charAt(i);
          if (((c < "0") || (c > "9"))) return false;
        }
        // All characters are numbers.
        return true;
      }

      function stripCharsInBag(s, bag) {
        var i;
        var returnString = "";
        // Search through string's characters one by one.
        // If character is not in bag, append to returnString.
        for (i = 0; i < s.length; i++) {
          var c = s.charAt(i);
          if (bag.indexOf(c) == -1) returnString += c;
        }
        return returnString;
      }

      function daysInFebruary(year) {
        // February has 29 days in any year evenly divisible by four,
        // EXCEPT for centurial years which are not also divisible by 400.
        return (((year % 4 == 0) && ((!(year % 100 == 0)) || (year % 400 == 0))) ? 29 : 28);
      }
      function DaysArray(n) {
        for (var i = 1; i <= n; i++) {
          this[i] = 31
          if (i == 4 || i == 6 || i == 9 || i == 11) { this[i] = 30 }
          if (i == 2) { this[i] = 29 }
        }
        return this
      }

      function isDate(dtStr) {
        var daysInMonth = DaysArray(12)
        var pos1 = dtStr.indexOf(dtCh)
        var pos2 = dtStr.indexOf(dtCh, pos1 + 1)
        var strMonth = dtStr.substring(0, pos1)
        var strDay = dtStr.substring(pos1 + 1, pos2)
        var strYear = dtStr.substring(pos2 + 1)
        strYr = strYear
        if (strDay.charAt(0) == "0" && strDay.length > 1) strDay = strDay.substring(1)
        if (strMonth.charAt(0) == "0" && strMonth.length > 1) strMonth = strMonth.substring(1)
        for (var i = 1; i <= 3; i++) {
          if (strYr.charAt(0) == "0" && strYr.length > 1) strYr = strYr.substring(1)
        }
        month = parseInt(strMonth)
        day = parseInt(strDay)
        year = parseInt(strYr)
        if (pos1 == -1 || pos2 == -1) {
          alert("The date format should be : mm/dd/yyyy")
          return false
        }
        if (strMonth.length < 1 || month < 1 || month > 12) {
          alert("Please enter a valid month")
          return false
        }
        if (strDay.length < 1 || day < 1 || day > 31 || (month == 2 && day > daysInFebruary(year)) || day > daysInMonth[month]) {
          alert("Please enter a valid day")
          return false
        }
        if (strYear.length != 4 || year == 0 || year < minYear || year > maxYear) {
          alert("Please enter a valid 4 digit year between " + minYear + " and " + maxYear)
          return false
        }
        if (dtStr.indexOf(dtCh, pos2 + 1) != -1 || isInteger(stripCharsInBag(dtStr, dtCh)) == false) {
          alert("Please enter a valid date")
          return false
        }
        return true
      }

      function ValidateForm() {
        var dt = document.addMemberForm.value;
        if (isDate(dt.value) == false) {
          dt.focus()
          return false
        }
        return true
      }
    }


  </script>
  </script>
</head>

<body>
  <!-- A grey horizontal navbar that becomes vertical on small screens -->
  <nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="/members">Members</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/add-donation-parvathiamman">Parvathiamman Kovil Vari</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/add-donation-ayyan">Ayyan Kovil Vari</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/expenses">Expenses</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/reports">Reports</a>
      </li>
    </ul>
  </nav>
  <br />
  <div class="container center_div">
    <h1>Add Member</h1>
    <form action="/api/members/" name="addMemberForm" method="POST">
      <div class="form-group">
        <label for="name">Name</label><span aria-hidden="true" class="required"></span><span
          style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="name" name="name"><br>


        <label for="address">Address</label><span aria-hidden="true" class="required"></span><span
          style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="address" name="address"><br>

        <label for="permanent_address">Permanent Address</label><span aria-hidden="true" class="required"></span>
        <span style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="permanent_address" name="permanent_address"><br>

        <label for="phone">Phone</label><span aria-hidden="true" class="required"></span>
        <span style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="phone" name="phone"><br>

        <label for="email">Email</label><span style=color:#ff0000>*</span>
        <input type="email" class="form-control" id="email" name="email"><br>

        <label for="aadhar">Aadhar</label><span aria-hidden="true" class="required"></span><span
          style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="aadhar" name="aadhar"><br>

        <span aria-hidden="true" class="required"></span>
        <label for="dob">
          <p>Date Of Birth<font color="#CC0000"><b>(mm/dd/yyyy)</b></font>
            :
          </p>
        </label><span aria-hidden="true" class="required"></span><span style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="dob" name="dob"><br>




        <input type="button" value="Add" onclick="submitData()">

      </div>
    </form>
  </div>
</body>

</html>