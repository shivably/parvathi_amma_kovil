<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    
    
    var query_param;
    function getUrlVars() {
      var vars = [], hash;
      var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
      for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
      }
      return vars;
    }
    $(document).ready(function () {
      query_param = getUrlVars();
      $.ajax({
        url: '/api/members/id/' + query_param.id,
        type: 'get',
        dataType: 'json',
        contentType: 'application/json',
        success: function (response_data) {
          var members = response_data[0]
          $("#id").val(members['id'])
          $("#name").val(members['name'])
          $("#address").val(members['address'])
          $("#permanent address").val(members['permanent address'])
          $("#phone").val(members['phone'])
          $("#email").val(members['email'])
          $("#aadhar").val(members['aadhar'])
          $("#dob").val(members['dob'])
        },
      });
    });
  
    function editData() {
     
      var validation_error = validateform();
      if (validation_error) {
        return;
      }
      var person = {
        id: query_param.id,
        name: $("#name").val(),
        address: $("#address").val(),
        permanent_address: $("#permanent_address").val(),
        phone: $("#phone").val(),
        email: $("#email").val(),
        aadhar: $("#aadhar").val(),
        dob: $("#dob").val(),
      }
      console.dir(person);
      $.ajax({
        url: '/api/members/',
        type: 'put',
        dataType: 'json',
        contentType: 'application/json',

        success: function (response_data) {

          if (response_data.response_action == 'redirect') {
            window.location.replace(response_data.url + "?msg=" + response_data.msg);
          }
        },
        data: JSON.stringify(person)
      });
    }
    function validateform() {
      var name = document.editMemberForm.name.value;
      if (name == null || name == "") {
        alert("Please Enter Your Name");
        return true;
      }
      var address = document.editMemberForm.address.value;
      if (address == "") {
        alert("Please Enter Your Address");
        document.editMemberForm.address.focus();
        return true;
      }
      var permanent_address = document.editMemberForm.permanent_address.value;
      if (permanent_address == "") {
        alert("Please Enter Your Permanent_Address");
        document.editMemberForm.permanent_address.focus();
        return true;
      }
      var phone = document.editMemberForm.phone.value;
      if (phone == "") {
        alert("Please Enter Your phone");
        document.editMemberForm.phone.focus();
        return true;
      }

      var email = document.editMemberForm.email.value;
      atpos = email.indexOf("@");
      dotpos = email.lastIndexOf(".");

      if (atpos < 1 || (dotpos - atpos < 2)) {
        alert("Please enter correct email")
        document.editMemberForm.email.focus();
        return true
      }
      return false;
    }
  </script>
</head>

<body>
    <!-- A grey horizontal navbar that becomes vertical on small screens -->
    <nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="/members">Members</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/add-donation-parvathiamman">Parvathiamman Kovil Vari</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/add-donation-ayyan">Ayyan Kovil Vari</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/expenses">Expenses</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/reports">Reports</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/expense_report">Expense Report</a>
        </li>
        </ul>
      </nav>
      <br/>
      <div class="container center_div">
    <h1>Edit Member</h1>
    <form action="/api/Members/" name="editMemberForm" method="POST">
      <div class="form-group">
        <label for="name">Name</label><span aria-hidden="true" class="required"></span><span
        style=color:#ff0000>*</span>
      <input type="text" class="form-control" id="name" name="name"><br>


      <label for="address">Address</label><span aria-hidden="true" class="required"></span><span
        style=color:#ff0000>*</span>
      <input type="text" class="form-control" id="address" name="address"><br>

      <label for="permanent_address">Permanent Address</label><span aria-hidden="true" class="required"></span>
      <span style=color:#ff0000>*</span>
      <input type="text" class="form-control" id="permanent_address" name="permanent_address"><br>

      <label for="phone">Phone</label><span aria-hidden="true" class="required"></span>
      <span style=color:#ff0000>*</span>
      <input type="text" class="form-control" id="phone" name="phone"><br>

      <label for="email">Email</label><span style=color:#ff0000>*</span>
      <input type="email" class="form-control" id="email" name="email"><br>

      <label for="aadhar">Aadhar</label><span aria-hidden="true" class="required"></span><span
        style=color:#ff0000>*</span>
      <input type="text" class="form-control" id="aadhar" name="aadhar"><br>

      <span aria-hidden="true" class="required"></span>
      
        <label for="dob"><p>Date Of Birth<font color="#CC0000"><b>(mm/dd/yyyy)</b></font>
          :
        </p></label><span aria-hidden="true" class="required"></span><span style=color:#ff0000>*</span>
        <input type="text" class="form-control" id="dob" name="dob"><br>
        

        <input type="button" value="Save" onclick="editData()">

      </div>
    </form>
  </div>
</body>

</html>