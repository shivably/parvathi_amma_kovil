<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function generate_balance_report() {
            var query = {
                'fromdate': $('#fromdate').val(),
                'todate': $('#todate').val()
            };
            $.ajax({
                url: '/api/reports/total_donation',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (response_data) {
                    console.log(response_data)
                    $('#total_donation').html(response_data[0]['TotalDonation'])
                    if (response_data.response_action == 'redirect') {
                        window.location.replace(response_data.url + "?msg=" + response_data.msg);
                    }
                },
                data: JSON.stringify(query)
            });

            $.ajax({
                url: '/api/reports/total_expense',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (response_data) {
                    console.log(response_data)
                    $('#total_expense').html(response_data[0]['TotalExpense'])
                    set_balance()
                    if (response_data.response_action == 'redirect') {
                        window.location.replace(response_data.url + "?msg=" + response_data.msg);
                    }
                },
                data: JSON.stringify(query)
            });
        }
        function set_balance() {
            $('#balance').html($('#total_donation').html() - $('#total_expense').html())


        }
    </script>

</head>

<body>
    <!-- A grey horizontal navbar that becomes vertical on small screens -->
    <nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/members">Members</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/add-donation-parvathiamman">Parvathiamman Kovil Vari</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/add-donation-ayyan">Ayyan Kovil Vari</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/expenses">Expenses</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/reports">Reports</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/expense_report">Expense Report</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="/balance">Balance sheet</a>
            </li>
        </ul>
    </nav>
    <br />
    <div class="container center_div">
        <h1>Balance Sheet</h1>
        <table id="example" class="display" style="width:100%">
            <thead>
                <th>Total Donation</th>
                <th>Total Expense</th>
            </thead>
    
            <div>
                <form>
                    <label for="date">From:</label>
                    <input type="date" id="fromdate">
                    <label for="date">To:</label>
                    <input type="date" id="todate">

                    <input type="button" value="Search" onclick="generate_balance_report()">
                </form>
                <div id="total_donation"></div>
                <div id="total_expense"></div>
                <div id="balance"></div>
            </div>
    </div>
    <script>
        function w3_open() {
            document.getElementsByClassName("w3-sidenav")[0].style.display = "block";
        }
        function w3_close() {
            document.getElementsByClassName("w3-sidenav")[0].style.display = "none";
        }
        document.getElementById('fromdate').value = new Date().toISOString().substring(0, 10);
        document.getElementById('todate').value = new Date().toISOString().substring(0, 10);
    </script>
</body>

</html>