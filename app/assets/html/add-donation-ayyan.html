<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    var income_type;
    var members;
    $(document).ready(function () {
      $.ajax({
        url: '/api/members/',
        type: 'get',
        contentType: 'application/json',
        success: function (response_data) {
          console.dir(response_data)
          members = response_data;
          $.each(response_data, function (k, v) {
            $('#member_id').append('<option value="' + v.id + '">' + v.name + '</option>');
          });
          // $.each(response_data, function (k, v) {
          //     $('#donor_contact').append('<input value="' + v.id + '">' + v.phone + '</input>');
          //   });
        }
      });
      /*$.ajax({
        url: '/api/ayyan_donation_type/',
        type: 'get',
        contentType: 'application/json',
        success: function (response_data) {
          console.dir(response_data)
          $.each(response_data, function (index, data) {
            $('#types_of_donation').append('<div class="row">');

            $('#types_of_donation').append('<div class="col">');
            $('#types_of_donation').append('<label for="donor_name">');
            $('#types_of_donation').append(data.name);
            $('#types_of_donation').append('</label>');
            $('#types_of_donation').append('</div>');
            $('#types_of_donation').append('<div class="col"><input type="text" placeholder="Unit value" id="donor_contact" name="donor_contact"></div>');
            $('#types_of_donation').append('<div class="col"><input type="text" placeholder="Quantity" id="donor_contact" name="donor_contact"></div>');
            $('#types_of_donation').append('<div class="col"><input type="text" class="donation_details_value" placeholder="Amount" id="donor_contact" name="donor_contact"></div>');
            $('#types_of_donation').append('</div>');

          });
        },
      });*/
    });
    function getmemberdetails(id) {
      if (id != 'NON_MEMBER') {
        for (var i = 0; i < members.length; i++) {
          console.log(members[i]['id']);

          if (id == members[i]['id']) {
            console.log(members[i]);

            $('#phone').html(members[i]["phone"]);
            $('#address').html(members[i]["address"])
            $('#member_detail').show();
            $('#non_member_detail').hide();
          }
        }
      } else {
        $('#phone').html();
        $('#address').html()
        $('#member_detail').hide();
        $('#non_member_detail').show();
      }

    }

    function compute(quantity) {
      var quantity_value = $("#quantity_value").val()
      $('#value').val(quantity_value * quantity);
    }
    function findTotal() {
      var arr = document.getElementsByClassName('amount');
      var tot = 0;
      for (var i = 0; i < arr.length; i++) {
        if (parseFloat(arr[i].value))
          tot += parseFloat(arr[i].value);
      } document.getElementById('total_amount').value = tot;
    }
    function multiply(name) {
      num1 = document.getElementById(name + "_unit_value").value;
      num2 = document.getElementById(name + "_quantity").value;
      result = num1 * num2;
      document.getElementById(name + "_value").value = result;
    }
    function update_quantity_value(id) {
      $.each(income_type, function (k, v) {
        if (v.id = id) {
          $('#quantity_value').val(v.value);
        }
      })
    }
    function submitData() {
      if ($("#member_id").val() == '' && $("#donor_name").val() == '') {
        alert("Please Enter Donor Details")
        return
      }
      if ($('#ithara_vari_value').val() == '' && $('#nemisa_vari_value').val() == '' && $('#undiyal_vari_value').val() == '' && $('#nankudai_vari_value').val() == '' && $('#seethana_vari_value').val() == '' && $('#kodai_vari_value').val() == '') {
        alert("Please Enter Values")
        return
      }
      var person = {
        member_id: $("#member_id").val(),
        name: $("#donor_name").val(),
        contact: $("#donor_contact").val()
      }
      console.dir(person);
      $.ajax({
        url: '/api/donor/',
        type: 'post',
        dataType: 'json',
        contentType: 'application/json',
        success: function (response_data) {
          receipt_id = response_data.id
          console.dir(response_data)
          var donation_details = []
          if ($('#kodai_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 1,
              unit_value: $('#kodai_vari_unit_value').val(),
              quantity: $('#kodai_vari_quantity').val(),
              value: $('#kodai_vari_value').val(),
            })
          }
          if ($('#seethana_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 2,
              unit_value: $('#seethana_vari_unit_value').val(),
              quantity: $('#seethana_vari_quantity').val(),
              value: $('#seethana_vari_value').val(),
            })
          }
          if ($('#nankudai_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 3,
              unit_value: $('#nankudai_vari_unit_value').val(),
              quantity: $('#nankudai_vari_quantity').val(),
              value: $('#nankudai_vari_value').val(),
            })
          }
          if ($('#undiyal_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 4,
              unit_value: $('#undiyal__vari_unit_value').val(),
              quantity: $('#undiyal__vari_quantity').val(),
              value: $('#undiyal_vari_value').val()
            })
          }
          if ($('#nemisa_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 5,
              unit_value: $('#nemisa_vari_unit_value').val(),
              quantity: $('#nemisa_vari_quantity').val(),
              value: $('#nemisa_vari_value').val()
            })
          }
          if ($('#ithara_vari_value').val() != '') {
            donation_details.push({
              receipt_id: receipt_id,
              donation_type: 6,
              unit_value: $('#ithara_vari_unit_value').val(),
              quantity: $('#ithara_vari_quantity').val(),
              value: $('#ithara_vari_value').val()
            })
          }

          console.dir(donation_details)
          $.ajax({
            url: '/api/donation_details/',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            success: function (response_data) {
              if (response_data.response_action == 'redirect') {
                window.location.replace(response_data.url + "?id=" + response_data.receipt_id);
              }
            },
            data: JSON.stringify(donation_details)
          });
        },
        data: JSON.stringify(person)
      });
    }
  </script>
</head>

<body>
  <!-- A grey horizontal navbar that becomes vertical on small screens -->
  <nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/members">Members</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/add-donation-parvathiamman">Parvathiamman Kovil Vari</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="/add-donation-ayyan">Ayyan Kovil Vari</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/expenses">Expenses</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/reports">Reports</a>
      </li>
      <li class="nav-item ">
        <a class="nav-link" href="/expense_report">Expense Report</a>
      </li>
    </ul>
  </nav>
  <br />
  <div class="container-fluid center_div">
    <h1>Donation</h1>
    <form action="/api/members/" name="addMemberForm" method="post">
      <div class="d-flex justify-content-between">
        <div>

          <label for="member_id">Member</label>
          <br>
          <select type="text" id="member_id" name="member_id" onchange="getmemberdetails(this.value)">
            <option value='NON_MEMBER'>Select Members</option>
          </select>      
          <div id="member_detail">
            <br>
            <div id="phone"></div>
            <br>
            <div id="address"></div>
          </div>
          <div id="non_member_detail">
            <label for="donor_name">Name</label><br>
            <input type="text" id="donor_name" name="donor_name" onchange=""><br>
            <label for="donor_contact" id="donor_contact">Contact</label><br>
            <input type="text" value="">
          </div>
        </div>
        <div>
          <div class="row">
            &nbsp;
          </div>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Kodai Vari
              </label>
            </div>
            <div class="col"><label for="kodai_vari_unit_value"></label><input type="number" placeholder="Unit value"
                onblur="multiply('kodai_vari')" id="kodai_vari_unit_value" name="kodai_vari_unit_value"></div>
            <div class="col"><label for="kodai_vari_quantity"></label><input type="number" placeholder="Quantity"
                onblur="multiply('kodai_vari')" id="kodai_vari_quantity" name="kodai_vari_quantity"></div>
            <div class="col"><label for="kodai_vari_value"></label><input type="text" class="amount"
                placeholder="Amount" onblur="findTotal()" id="kodai_vari_value" name="kodai_vari_value" readonly></div>
          </div>
          </br>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Seethana Vari
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <!--<div class="col"><input type="text" placeholder="Unit value" id="seethana_vari_unit_value"
              name="seethana_vari_unit_value"></div>
          <div class="col"><input type="text" placeholder="Quantity" id="seethana_vari_quantity"
              name="seethana_vari_quantity"></div> -->
            <div class="col"><input type="text" class="amount" placeholder="Amount" onblur="findTotal()"
                id="seethana_vari_value" name="seethana_vari_value">
            </div>
            </br>
          </div></br>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Nankudai Varavu
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <!-- <div class="col"><input type="text" placeholder="Unit value" id="nankudai_vari_unit_value"
              name="nankudai_vari_unit_value"></div>
          <div class="col"><input type="text" placeholder="Quantity" id="nankudai_vari_quantity"
              name="nankudai_vari_quantity"></div> -->
            <div class="col"><input type="text" class="amount" placeholder="Amount" onblur="findTotal()"
                id="nankudai_vari_value" name="nankudai_vari_value">
            </div>
          </div></br>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Undiyal Varavu
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <!-- <div class="col"><input type="text" placeholder="Unit value" id="undiyal__vari_unit_value"
              name="undiyal__vari_unit_value"></div>
          <div class="col"><input type="text" placeholder="Quantity" id="undiyal__vari_quantity"
              name="undiyal__vari_quantity"></div> -->
            <div class="col"><input type="text" class="amount" placeholder="Amount" onblur="findTotal()"
                id="undiyal_vari_value" name="undiyal_vari_value">
            </div>
          </div></br>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Nemisa Varavu
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <!-- <div class="col"><input type="text" placeholder="Unit value" id="nemisa_vari_unit_value"
              name="nemisa_vari_unit_value"></div>
          <div class="col"><input type="text" placeholder="Quantity" id="nemisa_vari_quantity"
              name="nemisa_vari_quantity"></div> -->
            <div class="col"><input type="text" class="amount" placeholder="Amount" onblur="findTotal()"
                id="nemisa_vari_value" name="nemisa_vari_value">
            </div>
          </div></br>
          <div class="row">
            <div class="col">
              <label for="donor_name">
                Ithara Varavu
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <div class="col"><input type="text" class="amount" placeholder="Amount" onblur="findTotal()"
                id="ithara_vari_value" name="ithara_vari_value">
            </div>
          </div>
          </br>
          <div class="row">
            <div class="col">
              <label for="total_amount">
                Total Amount
              </label>
            </div>
            <div class="col"></div>
            <div class="col"></div>
            <div class="col"><input type="text" placeholder="Total Amount" id="total_amount" name="total_amount"
                readonly>
            </div>
          </div>
          </br>
          <div class="row">
            <div class="col">
              <input type="button" value="Add" onclick="submitData()">
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

</body>

</html>